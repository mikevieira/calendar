

<script >

$(document).ready(function() {
   
    $('.tasks').draggable({
        helper: 'clone'
    });

    $('.cells').droppable({ 
      tolerance: 'pointer', 
      accept: '.tasks',
      drop: function(event, ui){
       
         var id = $(ui.draggable).attr('id');
         var taskinfo = $(ui.draggable).html();
         var day = $(this).attr('id');
         

         // $.ajax({
         //   type: 'PUT',
         //   url: localhost:3030/tasks/1,
         //
         //   data: { 
         //       "date": JSON.stringify(day) }, 

            var droppedItem = $(ui.draggable).clone();
            $(this).append(droppedItem);
            $(ui.draggable).remove();



           //  $(ui.draggable).remove();
           // $('#' + day).append('<div id="'+ id +'">' + taskinfo +'</div>');
           //   $('div#' +id).draggable({
           //    helper: 'clone'
           //   });
             

          

            // alert(day);



         
        }
     });
     
    });

  

</script>


</header>
  
<!--   <h1>Calendar of Fun</h1> -->

  
</header>

<!-- Rails to establish dates - .to_date converts to string -->
<% start_date = params.fetch(:start_date, Date.today).to_date %>
<% date_range = (start_date.beginning_of_month.beginning_of_week..start_date.end_of_month.end_of_week).to_a %>

<h4 class= 'text-center'><%= link_to "Previous", start_date: date_range.first - 1.day %>
<!-- change this from number to name of month -->
<%= start_date.month %> 
<%= start_date.year %>
<%= link_to "Next", start_date: date_range.last + 1.day %></h4>
<div class= 'super'>
<table class="container table table-striped table table-bordered">

  <thead >
   <tr class="row seven-cols">
     <th class="col">Sun</th>
     <th class="col">Mon</th>
     <th class="col">Tues</th>
     <th class="col">Wed</th>
     <th class="col">Thurs</th>
     <th class="col">Fri</th>
     <th class="col">Sat</th>
    </tr>
  </thead>
  <tbody>
  <% date_range.each_slice(7) do |week| %>
    
     <tr class="row seven-cols">
     <% week.each do |day| %>
           
      <td class='cells col' id=<%= idcreate(day) %> data-day=<%= day %>> <!-- td -->
        <h5 class= 'day'><%= shortday(day) %></h5>
        <% @tasks.select{|m| m.date == day}.each do |task| %>
          <div class="tasks" id=<%=task.id%> data-date=<%=task.date%>>
              <%= task.name %>
              <%= task.notes %>
          </div>
         <% end %>
        </td> <!-- td -->
      
     <% end %>
    </tr>
   <% end %>
  </tbody>
</table>
</div>


<br/>
<br/>

<b>Add a <%=link_to "New Task", new_task_path %> to the calendar</b>

